# TrustDAG - Decentralized File Storage Platform

<div align="center">

![TrustDAG](https://img.shields.io/badge/TrustDAG-Blockchain%20Storage-00FFFF?style=for-the-badge)
![Blockchain](https://img.shields.io/badge/Blockchain-BDAG-00BFA6?style=for-the-badge)
![IPFS](https://img.shields.io/badge/IPFS-Decentralized-0A0F24?style=for-the-badge)

**Secure, Decentralized File Storage with Role-Based Access Control**

Built with React, Ethereum Smart Contracts, IPFS, and AES-256 Encryption

[Features](#features) • [Installation](#installation) • [Configuration](#configuration) • [Usage](#usage) • [Testing](#testing)

</div>

---

## 🌟 Overview

TrustDAG is a decentralized file storage platform that combines blockchain technology with IPFS for secure, immutable file management. Files are encrypted client-side with AES-256 before being stored on IPFS, while smart contracts manage access control and metadata on the BDAG blockchain.

### Key Features

- 🔐 **End-to-End Encryption**: AES-256 encryption on your device
- 🌐 **Decentralized Storage**: IPFS with Web3.Storage & Pinata
- ⛓️ **Blockchain Access Control**: Immutable permissions on smart contract
- 👥 **Role-Based System**: Health, Government, Education, Organization, Individual
- 📊 **Audit Trail**: Complete blockchain event history
- 🎨 **Modern UI**: Glassmorphism design with Web3 aesthetics

---

## 🏗️ Architecture

```
┌─────────────────────────────────────────────────────────────┐
│                      User Interface (React)                  │
│  Wallet Connect • File Upload • Dashboard • Access Control  │
└────────────────────┬────────────────────────────────────────┘
                     │
        ┌────────────┴────────────┐
        │                         │
        ▼                         ▼
┌──────────────┐          ┌──────────────┐
│   MetaMask   │          │ Client-Side  │
│   Wallet     │          │ Encryption   │
│              │          │  (AES-256)   │
└──────┬───────┘          └──────┬───────┘
       │                         │
       │                         ▼
       │                  ┌──────────────┐
       │                  │     IPFS     │
       │                  │ Web3.Storage │
       │                  │   / Pinata   │
       │                  └──────────────┘
       │
       ▼
┌──────────────┐
│ Smart        │
│ Contract     │
│ (BDAG)       │
│              │
│ • Metadata   │
│ • Access     │
│ • Events     │
└──────────────┘
```

---

## 🚀 Installation

### Prerequisites

- **Node.js** v18+ and npm
- **MetaMask** browser extension installed
- **BDAG testnet** access (RPC endpoint & Chain ID)
- **Web3.Storage** account (or Pinata)

### Setup Steps

1. **Clone the repository**
   ```bash
   git clone <repository-url>
   cd TrustDAG
   ```

2. **Install dependencies**
   ```bash
   npm install
   ```

3. **Configure environment**
   ```bash
   cp .env.example .env
   ```

4. **Edit `.env` file** with your configuration:
   ```env
   # Contract (Already deployed - DO NOT CHANGE)
   VITE_CONTRACT_ADDRESS=0x6370e5bF266a7197F0426eB35cB01677BdcD2B3e
   
   # Network (REQUIRED)
   VITE_BDAG_RPC=https://your-bdag-rpc-endpoint
   VITE_CHAIN_ID=your-chain-id
   
   # IPFS (REQUIRED - At least one provider)
   VITE_WEB3STORAGE_TOKEN=your-web3-storage-token
   VITE_IPFS_API_KEY=025cd4fa307ecfdc0354
   VITE_IPFS_API_SECRET=74c3a521c1d59756b1f4f68aca4ee72b854307fb837841f2517e8884654738be
   ```

5. **Start the application**
   ```bash
   npm run dev
   ```

6. **Open in browser**
   ```
   http://localhost:5000
   ```

---

## ⚙️ Configuration

### Network Setup (MetaMask)

1. Open MetaMask
2. Click network dropdown → "Add Network"
3. Enter BDAG network details:
   - **Network Name**: BDAG Testnet
   - **RPC URL**: (from your `.env`)
   - **Chain ID**: (from your `.env`)
   - **Currency Symbol**: BDAG

### IPFS Provider Setup

#### Option A: Web3.Storage (Recommended)

1. Visit [web3.storage](https://web3.storage)
2. Create account & generate API token
3. Add to `.env`: `VITE_WEB3STORAGE_TOKEN=your-token`

#### Option B: Pinata (Fallback)

Already configured with provided credentials. To use your own:

1. Visit [pinata.cloud](https://pinata.cloud)
2. Get API Key & Secret
3. Update `.env` with your credentials

---

## 📖 Usage

### 1. Connect Wallet

- Click "Connect Wallet" button
- Approve MetaMask connection
- Ensure you're on BDAG network

### 2. Register Role

- Select your role: Health, Government, Education, Organization, or Individual
- Click "Register Role" (requires gas)
- Wait for transaction confirmation

### 3. Upload File

1. Go to **Upload** page
2. Drag & drop or select file
3. Enter file type/category
4. Click "Encrypt & Upload to IPFS"

**Process:**
- ✅ File encrypted with AES-256 on your device
- ✅ Uploaded to IPFS network
- ✅ Metadata recorded on blockchain

### 4. View Files

- **Dashboard** shows all your files and shared files
- Each file card displays:
  - File name & type
  - IPFS CID (content identifier)
  - Owner address
  - Upload timestamp
  - Encryption status

### 5. Manage Access

1. Go to **Access Control** page
2. Select file from dropdown
3. Enter Ethereum address to grant access
4. Click "Grant Access" (requires gas)

**To Revoke:**
- View granted addresses
- Click "Revoke" button next to address

### 6. Download File

1. Click "Download" on any file card
2. Contract verifies your access permission
3. File downloaded from IPFS
4. Automatically decrypted with AES key
5. File saved to your device

### 7. View Audit Trail

- Go to **Audit Trail** page
- See complete history of:
  - File uploads
  - Access grants
  - Access revocations
  - File accesses
- Filter by event type

---

## 🧪 Testing

### Manual Testing Flows

#### Test 1: Complete Upload Flow
```
1. Connect MetaMask → Success
2. Register as "Health" → Transaction confirmed
3. Upload test file (test.pdf) → 
   - Encryption: ✓
   - IPFS Upload: ✓
   - Blockchain Record: ✓
4. Verify file appears in Dashboard → ✓
5. Check Audit Trail for FileUploaded event → ✓
```

#### Test 2: Access Control Flow
```
1. Upload file as User A
2. Grant access to User B address
3. Switch to User B wallet
4. Verify file appears in "Shared With Me"
5. Download file successfully
6. Switch back to User A
7. Revoke access from User B
8. Switch to User B → Verify download fails
```

#### Test 3: Multi-Role Testing
```
1. Register as different roles:
   - Health
   - Government
   - Education
2. Upload files with each role
3. Verify role badges display correctly
4. Check dashboard segregation
```

### Testing Checklist

- [ ] **Wallet Connection**
  - [ ] MetaMask connects successfully
  - [ ] Balance displays correctly
  - [ ] Account changes reflected

- [ ] **Role Registration**
  - [ ] All 5 roles selectable
  - [ ] Transaction submits
  - [ ] Role displays after registration

- [ ] **File Upload**
  - [ ] Drag & drop works
  - [ ] File browse works
  - [ ] Encryption completes
  - [ ] IPFS upload succeeds
  - [ ] Blockchain transaction confirms
  - [ ] File appears in dashboard

- [ ] **Access Control**
  - [ ] Grant access transaction succeeds
  - [ ] Granted address appears in list
  - [ ] Revoke access works
  - [ ] Access verification prevents unauthorized downloads

- [ ] **File Download**
  - [ ] Owner can download
  - [ ] Granted user can download
  - [ ] Decryption successful
  - [ ] File integrity maintained

- [ ] **Audit Trail**
  - [ ] All events recorded
  - [ ] Filters work correctly
  - [ ] Event details accurate

---

## 📁 Project Structure

```
TrustDAG/
├── client/                      # Frontend React application
│   ├── src/
│   │   ├── components/          # Reusable UI components
│   │   │   ├── Navbar.tsx
│   │   │   ├── WalletConnect.tsx
│   │   │   ├── RoleRegistration.tsx
│   │   │   ├── FileUpload.tsx
│   │   │   ├── FileCard.tsx
│   │   │   ├── AccessControl.tsx
│   │   │   └── AuditTrail.tsx
│   │   ├── pages/               # Page components
│   │   │   ├── Dashboard.tsx
│   │   │   ├── UploadPage.tsx
│   │   │   ├── AccessPage.tsx
│   │   │   └── AuditPage.tsx
│   │   ├── contexts/            # React contexts
│   │   │   └── Web3Context.tsx  # Web3 wallet & contract state
│   │   ├── hooks/               # Custom React hooks
│   │   │   ├── useContract.ts   # Contract interaction hook
│   │   │   └── useFileData.ts   # Data fetching hooks
│   │   ├── utils/               # Utility functions
│   │   │   ├── encryption.ts    # AES-256 encryption
│   │   │   ├── ipfsHandler.ts   # IPFS upload/download
│   │   │   └── wallet.ts        # MetaMask helpers
│   │   ├── contract/            # Smart contract integration
│   │   │   ├── TrustDAG.json    # Contract ABI
│   │   │   └── contractConfig.ts# Contract configuration
│   │   └── App.tsx              # Main application
│   └── index.html
├── server/                      # Backend Express server
│   ├── routes.ts                # API routes
│   └── storage.ts               # In-memory storage
├── shared/                      # Shared types & schemas
│   └── schema.ts                # TypeScript schemas
├── .env.example                 # Environment template
└── README.md                    # This file
```

---

## 🔐 Security Considerations

### Client-Side Encryption

✅ **What We Do:**
- Generate unique AES-256 key per file
- Encrypt files entirely on your device
- Only encrypted data leaves your browser

⚠️ **MVP Limitations:**
- AES keys stored unencrypted in backend (for demo)
- **Production TODO**: Encrypt AES keys with recipient's public key

### Access Control

✅ **What We Do:**
- Smart contract enforces permissions
- Immutable access grants on blockchain
- Owner-only grant/revoke operations

### IPFS & Data Privacy

✅ **What We Do:**
- Store only encrypted data on IPFS
- Content addressing prevents tampering
- Decentralized, censorship-resistant storage

---

## 🛠️ Technology Stack

| Component | Technology |
|-----------|-----------|
| **Frontend** | React 18 + TypeScript |
| **Styling** | Tailwind CSS + Shadcn UI |
| **Blockchain** | Ethers.js v6 + MetaMask |
| **Storage** | IPFS (Web3.Storage / Pinata) |
| **Encryption** | CryptoJS (AES-256) |
| **Backend** | Express.js + Node.js |
| **State** | TanStack Query (React Query) |

---

## 🐛 Troubleshooting

### "MetaMask Not Found"
- Install MetaMask browser extension
- Refresh the page

### "Wrong Network"
- Click the network switch prompt
- Or manually add BDAG network in MetaMask

### "Transaction Failed: Insufficient Funds"
- Get testnet tokens from BDAG faucet
- Ensure you have enough for gas fees

### "IPFS Upload Failed"
- Check your Web3.Storage token is valid
- Verify Pinata credentials if using
- Check network connectivity

### "Failed to Load Files"
- Check backend is running (`npm run dev`)
- Verify contract address is correct
- Ensure wallet is connected

---

## 📝 Smart Contract

**Deployed Address:** `0x6370e5bF266a7197F0426eB35cB01677BdcD2B3e`

**⚠️ DO NOT MODIFY OR REDEPLOY THE CONTRACT**

The contract is already deployed and functional. Modifying or redeploying will break the application.

### Key Contract Functions

```solidity
// Register user role
function registerRole(string memory role) public

// Upload file metadata
function uploadFile(string memory ipfsHash, string memory fileType) 
    public returns (uint256)

// Grant file access
function grantAccess(uint256 fileId, address user) public

// Revoke file access
function revokeAccess(uint256 fileId, address user) public

// Get file IPFS hash (requires permission)
function getFileHash(uint256 fileId) public returns (string memory)

// Get user's role
function getRole(address user) public view returns (string memory)

// Check access permission
function hasAccess(uint256 fileId, address user) 
    public view returns (bool)
```

---

## 📜 License

This project is for educational and demonstration purposes.

---

## 🤝 Support

For issues or questions:

1. Check this README
2. Review the code comments (comprehensive inline documentation)
3. Check browser console for errors
4. Verify MetaMask network settings
5. Ensure all environment variables are set correctly

---

<div align="center">

**Built with ❤️ using Blockchain, IPFS, and Modern Web Technologies**

[Back to Top](#trustdag---decentralized-file-storage-platform)

</div>
